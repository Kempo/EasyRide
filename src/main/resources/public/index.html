<html>
<head>
    <script src="./jquery.js"></script>
    <script type="text/javascript">
        

        $(document).ready(function(){
            $("#rides").change(function () {
                $('#val').text(this.value.replace(/C:\\fakepath\\/i, ''));
                /* REMOVED
                var fr = new FileReader();
                fr.onload = function () {
                    $("#displayContents").html(this.result);
                };
                fr.readAsText(this.files[0]);
                */
            });

            $("#submitSheets").click(function() {
                toggleLoading();
                alert($("sheetsSubmission").serialize());
                $.post("/sheets", $("sheetsSubmission").serialize(), function(data, error) {
                    data = data.replace(/\n/g, "<br>");
                    $("#result").contents().find("body").html(data);
                    toggleLoading();
                });
            }); 


        });



        function selectFile() {
            $("#rides").trigger('click');
        }

        function sendData() {
            toggleLoading();
            var fr = new FileReader();
            fr.onload = function(event) {
                var result = event.target.result;

                $.post("/rides", result, function(result, error) {
                    result = result.replace(/\n/g, "<br>");
                    //$("#result").html(result);
                    $("#result").contents().find("body").html(result);
                    toggleLoading();
                });
            };
            var rides = $("#rides");
            var files = rides[0]['files'];
            var file = files[0];
            fr.readAsText(file, 'ASCII');
        }

/*
        function read() {
            toggleLoading();
            var result = "test";
            $.post("/sheets", function(result) {
                result = result.replace(/\n/g, "<br>");
                $("#result").html(result);
                toggleLoading();
            });
        }
*/
      function toggleLoading() {
        var status = document.getElementById("loadingImage").style.visibility;
        if(status == "" || status == "hidden") {
            document.getElementById("result").style.background = "#f7f7f7";
            document.getElementById("loadingImage").style.visibility = "visible";

        } else if (status == "visible") {
            document.getElementById("result").style.background = "white";
            document.getElementById("loadingImage").style.visibility = "hidden";
        }
      }

    </script>
    <title> EasyRide </title>
    <link rel="stylesheet" href="styles.css">
</head>


<body>
    <div id="title">
        <h1> EasyRide </h1>
    </div>

    <div id="instructions">
        <h1>Upload a .tsv file (tab-separated value) with the following format:</h1>
        <p>
        name | address | designation (either "driver" or "rider") | number of spaces (if driver).
        </p>
    </div>

    <div id="exampleInput">
        <b>Example Input:</b>
        <pre>billy   33  4th street  driver  3<br>sandy   355 5th AVE S   rider    <br>andy    41  6th street  driver  5<br>
        </pre>
    </div>
    <!-- previous stuff for note
<input id="rides" type="file" accept=".tsv">
<br>


<button onclick="sendData()">Submit</button>
    -->

    <div id='fileinput'>
    <input type='file' id='rides' accept='.tsv'>
    <span id='val'></span>
    <span id='buttonSelect' onclick="selectFile();">...</span>
    <span id='buttonSubmit' onclick="sendData();">Submit</span>
    </div>

    <!--
<div id="displayContents">
    </div>
    -->
    <div>
    <iframe name="output" id="result"></iframe>
    </div>

    <div id="loadingImage">
    <img src="misc\loading.gif" width="50px" height="50px">
    </div>


    <form action="/sheets" method="POST" id="sheetsSubmission" target="output"> 
    Sheet URL: <input type="text" name="sheetURL"><br>
    Range: <input type="text" name="dataRange"><br>
    <!--
    <input type="submit" value="Submit">
    -->
    <input type="button" value="Submit" id="submitSheets">
    </form>

    <!--
    <iframe name="output" id="outputframe"></iframe>
    -->

</body>
</html>
